name: Conftest Terraform Scan

on:
  issues:
    type:
      - closed
      - opened

jobs:
  conftest_terraform_scan:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install conftest
      run: |
        curl -L -o conftest https://github.com/open-policy-agent/conftest/releases/latest/download/conftest_$(uname -s)_$(uname -m)
        chmod +x conftest
        sudo mv conftest /usr/local/bin/

    - name: Run Conftest Terraform scan
      run: |
        conftest test ./
